## Post Todo with User ID

In this section, we’ll update the **create todo** endpoint so that each todo is linked to the currently authenticated user. This ensures todos are always associated with the user who created them.

### Add the following (in `todos.py`)

```python
from .auth import get_current_user

user_dependency = Annotated[dict, Depends(get_current_user)]

@router.post("/todo", status_code=status.HTTP_201_CREATED)
def create_todo(user: user_dependency, db: db_dependency, todo_request: TodoRequest):
    if user is None:
        raise HTTPException(status_code=401, detail="Authentication Failed")
    todo_model = Todos(**todo_request.model_dump(), owner_id=user.get('id'))

    db.add(todo_model)
    db.commit()
```

- **`user_dependency`**

  - Uses `get_current_user` from `auth.py` to decode the JWT.
  - Injects the current user info into this endpoint (e.g., `{ "username": ..., "id": ... }`).

- **`if user is None`**

  - If the token is invalid or missing, raise a **401 Unauthorized** error.

- **`Todos(**todo_request.model_dump(), owner_id=user.get('id'))`\*\*

  - Builds a new `Todos` object from the request.
  - Assigns the **authenticated user’s ID** to the `owner_id` field.

- **`db.add(...)` & `db.commit()`**

  - Saves the new todo in the database, linked to the correct user.

> When you click the lock in Swagger UI and enter username & password, Swagger logs you in by calling `/auth/token`, grabs the JWT, and uses it automatically for your next requests.
