## Authenticate User and Login Endpoint

So far, we’ve been able to create users and store them in the database with their passwords hashed. Now we need a way to **log in a user** and check whether their credentials are valid.

### Step 1: Required Import

At the top of `auth.py`, add the following import:

```python
from fastapi.security import OAuth2PasswordRequestForm
```

This class will allow us to extract `username` and `password` from the login request in a way that follows the OAuth2 specification.

### Step 2: Authenticate User Function

We create a helper function called `authenticate_user` that:

1. Looks up the user by username.
2. If the user does not exist → return `False`.
3. If the user exists, it verifies the entered password against the hashed password stored in the database.
4. If the password is correct → return the user, otherwise return `False`.

```python
def authenticate_user(username: str, password: str, db):
    user = db.query(Users).filter(Users.username == username).first()
    if not user:
        return False
    if not bcrypt_context.verify(password, user.hashed_password):
        return False
    return True
```

### Step 3: Login Endpoint

We then create a login endpoint `/token` where users send their username and password.

```python
@router.post("/token")
def login_for_access_token(form_data: Annotated[OAuth2PasswordRequestForm, Depends()], db: db_dependency):
    user = authenticate_user(form_data.username, form_data.password, db)
    if not user:
        return "Failed Authentication"
    return "Successfully authenticated"
```

- `OAuth2PasswordRequestForm` is a built-in dependency that extracts `username` and `password` from the login form.
- The `authenticate_user` function checks the database for a matching username and verifies the password.
- If authentication fails → return `"Failed Authentication"`.
- If authentication succeeds → return `"Successfully authenticated"`.

### Testing in Swagger UI

1. Go to `/docs`.
2. Open the `/token` endpoint.
3. Enter the **username** and **password** of a user you created earlier.
4. You’ll either get:

   - `"Failed Authentication"` → wrong username or password.
   - `"Successfully authenticated"` → credentials are valid.
