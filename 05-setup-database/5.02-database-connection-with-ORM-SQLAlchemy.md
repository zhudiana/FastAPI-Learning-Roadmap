## Database Connection with ORM SQLAlchemy

We are going to build Project 3, _a todo app_, and learn about database and database connection as well.

We are going to create a todo app for our next project. For that, we will create a python package. A package in python is just a folder that contains a special file called `__init__.py`. Using packages helps importing files very easy. For example:

```python
project/
 └── utils/
      ├── __init__.py   #makes it a package
      └── helper.py
```

- utils is now a package since it has an `__init__.py`

- We can do the following:

```python
import utils.helper # Python knows utils is a package
```

Let's create a pyton package called **TodoApp**. Create a new folder called `TodoApp` and inside it, create `__init__.py`.

Inside the package, create `databse.py` as well. Our database file is going to be used for us to be able to create _URL string_ which will connect our fastapi application to our new database. We are going to use _SQLite_.

```
TodoApp/
    ├── __init__.py
    └── database.py
```

Now go inside our TodoApp project in the terminal:

```shell
cd TodoApp
```

Before writing anything in `databse.py`, we need to install [SQLAlchemy](https://docs.sqlalchemy.org/en/20/orm/).

- SQLAlchemy is an ORM (Onject Relational Mapping), which our fastapi is going to be using, to create a database, be able to create a connection to the database and use all the database records within our application.

Don't forget to activate your virtual environment before installing anything.

```shell
pip install sqlalchemy
```

Inside your `database.py`, add the following:

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from sqlalchemy.ext.declarative import declarative_base

SQLALCHEMY_DATABASE_URL = 'sqlite:///./todos.db'

engine = create_engine(
    SQLALCHEMY_DATABASE_URL,
    connect_args={'check_same_thread': False}
)

SessionLocal = sessionmaker(
    autocommit=False,
    autoflush=False,
    bind=engine
)

Base = declarative_base()
```

Let's see what each line does.

1.

```python
SQLALCHEMY_DATABASE_URL = 'sqlite:///./todos.db
```

We are tellig SQLAlchemy to store our database in file called `todos.db` inside the `TodoApp project` folder.

2. `from sqlalchemy import create_engine`

```python
engine = create_engine(
    SQLALCHEMY_DATABASE_URL,
    connect_args={'check_same_thread': False}
)
```

- `create_engine()` is the main SQLAlchemy function to set up the database connection.

3. from sqlalchemy.orm import sessionmaker

```python
SessionLocal = sessionmaker(
    autocommit=False,  # require explicit commit
    autoflush=False,   # don’t automatically flush changes before queries
    bind=engine        # use the engine you just created
)
```

- A session in SQLAlchemy is how you talk to the database (run queries, add rows, commit changes).

- `sessionmaker()` is a factory that gives you new Session objects.

4. `from sqlalchemy.ext.declarative import declarative_base`

```python
Base = declarative_base()
```

- This is how we define your ORM models (tables).
